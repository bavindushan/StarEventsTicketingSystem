@model StarEventsTicketingSystem.ViewModels.RegisterViewModel

@{
    ViewData["Title"] = "Register - Star Events";
}

<div class="d-flex justify-content-center align-items-center vh-100 bg-light mt-5 pt-5 mb-5 pb-5">
    <div class="card shadow-lg border-0 rounded-4" style="max-width: 600px; width: 100%;">
        <div class="card-body p-5">
            <!-- Header -->
            <div class="text-center mb-4">
                <i class="bi bi-person-plus text-primary" style="font-size: 2.5rem;"></i>
                <h2 class="fw-bold text-dark mt-2">Create Account</h2>
                <p class="text-muted small">Join Star Events and start your journey</p>
            </div>

            <form id="registerForm" asp-action="Register" method="post">
                <!-- Full Name -->
                <div class="mb-3">
                    <label asp-for="FullName" class="form-label fw-semibold">
                        <i class="bi bi-person me-1"></i> Full Name
                    </label>
                    <input asp-for="FullName" class="form-control" placeholder="Enter your full name" />
                    <span asp-validation-for="FullName" class="text-danger small"></span>
                </div>

                <!-- Email -->
                <div class="mb-3">
                    <label asp-for="Email" class="form-label fw-semibold">
                        <i class="bi bi-envelope me-1"></i> Email
                    </label>
                    <input asp-for="Email" class="form-control" placeholder="Enter your email" />
                    <span asp-validation-for="Email" class="text-danger small"></span>
                </div>

                <!-- Password -->
                <div class="mb-3">
                    <label asp-for="Password" class="form-label fw-semibold">
                        <i class="bi bi-lock me-1"></i> Password
                    </label>
                    <input asp-for="Password" id="password" class="form-control" type="password" placeholder="Enter your password" />
                    <div class="mt-1">
                        <div class="progress" style="height: 5px;">
                            <div id="passwordStrength" class="progress-bar" role="progressbar" style="width:0%;"></div>
                        </div>
                        <small id="passwordStrengthText" class="text-muted"></small>
                    </div>
                    <span asp-validation-for="Password" class="text-danger small"></span>
                </div>

                <!-- Confirm Password -->
                <div class="mb-3">
                    <label asp-for="ConfirmPassword" class="form-label fw-semibold">
                        <i class="bi bi-shield-lock me-1"></i> Confirm Password
                    </label>
                    <input asp-for="ConfirmPassword" class="form-control" type="password" placeholder="Confirm password" />
                    <span asp-validation-for="ConfirmPassword" class="text-danger small"></span>
                </div>

                <!-- Phone Number -->
                <div class="mb-3">
                    <label asp-for="PhoneNumber" class="form-label fw-semibold">
                        <i class="bi bi-telephone me-1"></i> Phone Number
                    </label>
                    <input asp-for="PhoneNumber" class="form-control" placeholder="Enter your phone number" />
                    <span asp-validation-for="PhoneNumber" class="text-danger small"></span>
                </div>

                <!-- Address -->
                <div class="mb-3">
                    <label asp-for="Address" class="form-label fw-semibold">
                        <i class="bi bi-geo-alt me-1"></i> Address
                    </label>
                    <input asp-for="Address" class="form-control" placeholder="Enter your address" />
                    <span asp-validation-for="Address" class="text-danger small"></span>
                </div>

                <!-- Role -->
                <div class="mb-4">
                    <label asp-for="Role" class="form-label fw-semibold">
                        <i class="bi bi-briefcase me-1"></i> Role
                    </label>
                    <select asp-for="Role" class="form-select" asp-items="Html.GetEnumSelectList<StarEventsTicketingSystem.Enums.Role>()">
                        <option value="">Select Role</option>
                    </select>
                    <span asp-validation-for="Role" class="text-danger small"></span>
                </div>

                <!-- Submit -->
                <button type="submit" class="btn btn-primary w-100 py-2 fw-semibold rounded-3">
                    <i class="bi bi-person-plus me-1"></i> Register
                </button>
            </form>

            <!-- Login Link -->
            <div class="text-center mt-4">
                <p class="mb-0 text-muted small">
                    Already have an account?
                    <a asp-controller="Account" asp-action="Login" class="text-decoration-none text-primary fw-semibold">
                        Login here
                    </a>
                </p>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <script>
        const passwordInput = document.getElementById('password');
        const strengthBar = document.getElementById('passwordStrength');
        const strengthText = document.getElementById('passwordStrengthText');

        passwordInput.addEventListener('input', () => {
            const val = passwordInput.value;
            let score = 0;
            let text = '';
            if (val.length >= 6) score++;
            if (/[A-Z]/.test(val)) score++;
            if (/[0-9]/.test(val)) score++;
            if (/[\W]/.test(val)) score++;

            switch(score){
                case 0: strengthBar.style.width = '0%'; text = ''; break;
                case 1: strengthBar.style.width = '25%'; strengthBar.className='progress-bar bg-danger'; text='Weak'; break;
                case 2: strengthBar.style.width = '50%'; strengthBar.className='progress-bar bg-warning'; text='Medium'; break;
                case 3: strengthBar.style.width = '75%'; strengthBar.className='progress-bar bg-info'; text='Strong'; break;
                case 4: strengthBar.style.width = '100%'; strengthBar.className='progress-bar bg-success'; text='Very Strong'; break;
            }
            strengthText.textContent = text;
        });

        // SweetAlert for form submission
        const form = document.getElementById('registerForm');
        form.addEventListener('submit', async (e) => {
            e.preventDefault();

            // Check password strength before submit
            if(strengthBar.style.width !== '100%'){
                await Swal.fire({
                    icon: 'error',
                    title: 'Password too weak',
                    text: 'Password must be at least 6 chars, include uppercase, number, and special char'
                });
                return;
            }

            // Terms & Conditions
            const { value: accept } = await Swal.fire({
                title: "Terms and Conditions",
                input: "checkbox",
                inputValue: 1,
                inputPlaceholder: "I agree with the terms and conditions",
                confirmButtonText: "Continue",
                inputValidator: (result) => !result && "You need to agree with T&C"
            });

            if (!accept) return;

            // If everything ok, submit the form
            form.submit();
        });
    </script>
}
